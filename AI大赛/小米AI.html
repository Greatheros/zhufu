<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>神秘答案之书 - 星辰抽卡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', 'SimSun', sans-serif;
        }

        body {
            background: #0a0a1a;
            color: #e6e6fa;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            transition: background 2s ease;
        }

        /* 6个时间段的独特背景 - 强化夜晚对比度 */
        
        /* 1. 清晨 (5:00-8:00) - 粉紫色晨光 */
        body.dawn {
            background: linear-gradient(135deg, #2c1b47 0%, #5a3a7a 30%, #d4a5f0 70%, #ffd700 100%);
        }

        /* 2. 中午 (8:00-16:00) - 明亮蓝色天空 */
        body.noon {
            background: linear-gradient(180deg, #4a90e2 0%, #87ceeb 50%, #e6f2ff 100%);
        }

        /* 3. 傍晚 (16:00-19:00) - 橙红色夕阳 */
        body.dusk {
            background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 30%, #ff4e50 70%, #2c1654 100%);
        }

        /* 4. 入夜 (19:00-22:00) - 深蓝色+紫色调，星空初现 */
        body.dusknight {
            background: linear-gradient(180deg, #0a0a2e 0%, #1a1a4e 40%, #2d1b69 100%);
        }

        /* 5. 深夜 (22:00-2:00) - 纯黑色，最深夜晚，带微弱星光 */
        body.latenight {
            background: radial-gradient(ellipse at bottom, #000000 0%, #000000 50%, #0a0a1a 100%);
        }

        /* 6. 黎明 (2:00-5:00) - 蓝灰色，黎明前，带冷色调 */
        body.predawn {
            background: linear-gradient(135deg, #1a1a2e 0%, #2d3142 40%, #4a5568 80%, #718096 100%);
        }

        /* 星空背景 - 仅夜晚时段显示 (入夜、深夜、黎明) */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -3;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
            opacity: 0;
            visibility: hidden;
            transition: opacity 2s ease, visibility 2s ease;
        }

        body.dusknight .stars,
        body.latenight .stars,
        body.predawn .stars {
            opacity: 1;
            visibility: visible;
        }

        /* 深夜和黎明的星空增强区分 */
        body.latenight .stars {
            opacity: 1.2;
            filter: brightness(1.5) contrast(1.2);
        }

        body.predawn .stars {
            opacity: 0.6;
            filter: brightness(0.7) contrast(0.8) grayscale(0.3);
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle var(--duration, 3s) infinite ease-in-out;
            animation-delay: var(--delay, 0s);
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* 天体容器 */
        .celestial {
            position: fixed;
            width: 100%;
            height: 150px;
            z-index: -2;
            display: flex;
            justify-content: space-between;
            padding: 0 5%;
            transition: top 2s ease;
        }

        /* 太阳和月亮基础样式 - 默认隐藏 */
        .sun, .moon {
            position: relative;
            border-radius: 50%;
            filter: blur(0.5px);
            opacity: 0;
            visibility: hidden;
            transition: all 2s ease;
            pointer-events: none;
        }

        /* 太阳 - 仅白天显示 (清晨、中午、傍晚) */
        .sun {
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #ffd700 0%, #ffa500 40%, transparent 70%);
            box-shadow: 0 0 60px rgba(255, 215, 0, 0.3);
            animation: sunPulse 8s infinite alternate;
        }

        /* 太阳位置和大小变化 */
        body.dawn .sun {
            opacity: 1;
            visibility: visible;
            width: 80px;
            height: 80px;
            top: 20px;
            left: 20%;
        }

        body.noon .sun {
            opacity: 1;
            visibility: visible;
            width: 120px;
            height: 120px;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        body.dusk .sun {
            opacity: 1;
            visibility: visible;
            width: 90px;
            height: 90px;
            top: 30px;
            right: 20%;
            left: auto;
        }

        /* 月亮 - 仅夜晚显示 (入夜、深夜、黎明) */
        .moon {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #e6e6fa 0%, #d3d3d3 40%, transparent 70%);
            animation: moonGlow 10s infinite alternate;
            box-shadow: 0 0 60px rgba(230, 230, 250, 0.2);
            position: relative;
            overflow: hidden;
        }

        .moon::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 15px;
            width: 15px;
            height: 15px;
            background: rgba(100, 100, 120, 0.3);
            border-radius: 50%;
            box-shadow: 5px 5px 0 5px rgba(100, 100, 120, 0.2);
        }

        /* 月亮位置和大小变化 */
        body.dusknight .moon {
            opacity: 1;
            visibility: visible;
            width: 70px;
            height: 70px;
            top: 10px;
            right: 30%;
            left: auto;
        }

        body.latenight .moon {
            opacity: 1;
            visibility: visible;
            width: 85px;
            height: 85px;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            filter: brightness(1.3) contrast(1.1);
        }

        body.predawn .moon {
            opacity: 1;
            visibility: visible;
            width: 65px;
            height: 65px;
            top: 20px;
            left: 20%;
            filter: brightness(0.8) contrast(0.9) grayscale(0.2);
        }

        @keyframes sunPulse {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.1); opacity: 1; box-shadow: 0 0 80px rgba(255, 215, 0, 0.5); }
        }

        @keyframes moonGlow {
            0% { transform: translateY(0); opacity: 0.7; }
            100% { transform: translateY(-5px); opacity: 1; box-shadow: 0 0 50px rgba(230, 230, 250, 0.4); }
        }

        /* 主容器 */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        /* 天文信息面板 - 隐藏实时时间 */
        .astro-info {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.6);
            padding: 12px 18px;
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            font-size: 0.85rem;
            color: #ffd700;
            z-index: 100;
            backdrop-filter: blur(5px);
            min-width: 180px;
            transition: all 0.5s ease;
        }

        .astro-info.night {
            border-color: rgba(230, 230, 250, 0.3);
            color: #e6e6fa;
        }

        /* 隐藏实时时间显示 */
        .time-current {
            display: none;
        }

        .time-period {
            font-size: 0.85rem;
            text-transform: uppercase;
            opacity: 0.9;
            margin-bottom: 8px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .astro-times {
            font-size: 0.7rem;
            line-height: 1.4;
            opacity: 0.9;
        }

        .astro-times div {
            margin: 3px 0;
        }

        .astro-status {
            font-size: 0.75rem;
            margin-top: 8px;
            padding: 4px 8px;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            font-weight: bold;
        }

        body.dusknight .astro-status,
        body.latenight .astro-status,
        body.predawn .astro-status {
            background: rgba(230, 230, 250, 0.2);
        }

        header {
            margin-bottom: 50px;
            animation: fadeIn 1.5s ease;
        }

        h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ffd700, #e6e6fa, #ffd700);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
            letter-spacing: 3px;
            font-weight: 300;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #a0a0c0;
            margin-bottom: 20px;
            letter-spacing: 1px;
        }

        .instruction {
            font-size: 0.95rem;
            color: #8888bb;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* 抽卡区域 */
        .card-area {
            position: relative;
            height: 420px;
            margin: 30px auto;
            perspective: 1200px;
            max-width: 350px;
        }

        .card-container {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }

        .card-container.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .card-front {
            background: linear-gradient(135deg, rgba(30, 30, 60, 0.95) 0%, rgba(15, 15, 30, 0.95) 100%);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 25px;
            z-index: 2;
        }

        .card-back {
            background: linear-gradient(135deg, rgba(40, 40, 80, 0.95) 0%, rgba(20, 20, 50, 0.95) 100%);
            backdrop-filter: blur(10px);
            transform: rotateY(180deg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 25px;
            z-index: 1;
        }

        .front-symbol {
            width: 90px;
            height: 90px;
            margin-bottom: 20px;
            position: relative;
            animation: symbolFloat 4s infinite ease-in-out;
        }

        .front-star {
            width: 0;
            height: 0;
            border-left: 45px solid transparent;
            border-right: 45px solid transparent;
            border-bottom: 32px solid #ffd700;
            position: relative;
            filter: drop-shadow(0 0 12px #ffd700);
        }

        .front-star::before {
            content: '';
            position: absolute;
            top: 10px;
            left: -28px;
            width: 0;
            height: 0;
            border-left: 28px solid transparent;
            border-right: 28px solid transparent;
            border-bottom: 20px solid #ffd700;
            transform: rotate(35deg);
        }

        .front-star::after {
            content: '';
            position: absolute;
            top: 10px;
            right: -28px;
            width: 0;
            height: 0;
            border-left: 28px solid transparent;
            border-right: 28px solid transparent;
            border-bottom: 20px solid #ffd700;
            transform: rotate(-35deg);
        }

        @keyframes symbolFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        .front-text {
            font-size: 1.1rem;
            line-height: 1.8;
            text-align: center;
            color: #e6e6fa;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.2);
        }

        .back-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 10px currentColor);
            animation: iconFloat 4s infinite ease-in-out;
            font-family: Arial, sans-serif;
        }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .back-answer {
            font-size: 1.4rem;
            font-weight: 500;
            color: #ffd700;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
            animation: textGlow 2s infinite alternate;
            line-height: 1.4;
            text-align: center;
        }

        @keyframes textGlow {
            0% { text-shadow: 0 0 5px rgba(255, 215, 0, 0.3); }
            100% { text-shadow: 0 0 15px rgba(255, 215, 0, 0.6); }
        }

        .back-category {
            font-size: 0.9rem;
            color: #a0a0c0;
            letter-spacing: 1px;
            text-transform: uppercase;
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 12px;
            border-radius: 12px;
        }

        /* 抽卡按钮 - 增大点击区域 */
        .draw-btn {
            background: linear-gradient(45deg, #ffd700, #ffa500, #ffd700);
            background-size: 200% 200%;
            border: none;
            padding: 20px 60px;
            border-radius: 50px;
            color: #1a1a2e;
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
            margin: 20px 0;
            position: relative;
            overflow: hidden;
            min-width: 200px;
            min-height: 60px;
            display: inline-block;
            touch-action: manipulation;
        }

        .draw-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.6);
            background-position: 100% 0;
        }

        .draw-btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
        }

        .draw-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            filter: grayscale(0.8);
            transform: none;
        }

        .draw-btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transform: rotate(45deg);
            transition: all 0.6s ease;
            opacity: 0;
        }

        .draw-btn:hover::after {
            opacity: 1;
            transform: rotate(45deg) translate(50%, 50%);
        }

        /* 音效开关 */
        .sound-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .sound-toggle:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.1);
        }

        .sound-toggle.muted {
            opacity: 0.5;
            filter: grayscale(0.5);
        }

        /* 粒子效果 */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: particleFloat 15s infinite linear;
            opacity: 0;
            transition: opacity 1s ease;
        }

        /* 不同时间段的粒子颜色 */
        body.dawn .particle {
            background: rgba(255, 200, 255, 0.7);
            box-shadow: 0 0 10px rgba(255, 200, 255, 0.5);
            opacity: 0.5;
        }

        body.noon .particle {
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.7);
            opacity: 0.6;
        }

        body.dusk .particle {
            background: rgba(255, 100, 100, 0.7);
            box-shadow: 0 0 10px rgba(255, 100, 100, 0.5);
            opacity: 0.6;
        }

        body.dusknight .particle {
            background: rgba(100, 150, 255, 0.7);
            box-shadow: 0 0 10px rgba(100, 150, 255, 0.5);
            opacity: 0.7;
        }

        body.latenight .particle {
            background: rgba(255, 215, 0, 0.7);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            opacity: 0.8;
        }

        body.predawn .particle {
            background: rgba(150, 150, 150, 0.7);
            box-shadow: 0 0 10px rgba(150, 150, 150, 0.5);
            opacity: 0.5;
        }

        @keyframes particleFloat {
            0% { transform: translateY(100vh) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 0.5; }
            100% { transform: translateY(-100px) translateX(100px); opacity: 0; }
        }

        /* 抽卡特效 */
        .draw-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
            display: none;
        }

        .draw-effect.active {
            display: block;
        }

        .light-beam {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 2px;
            height: 0;
            background: linear-gradient(to top, transparent, #ffd700, transparent);
            transform-origin: center bottom;
            animation: beamExpand 1.5s ease-out;
            box-shadow: 0 0 20px #ffd700;
        }

        @keyframes beamExpand {
            0% { height: 0; opacity: 0; transform: translate(-50%, -50%) rotate(0deg); }
            20% { opacity: 1; }
            100% { height: 150vh; opacity: 0; transform: translate(-50%, -50%) rotate(180deg); }
        }

        .glow-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 100px;
            border: 2px solid #ffd700;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: ringExpand 1.5s ease-out;
            opacity: 0;
        }

        @keyframes ringExpand {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(8); opacity: 0; }
        }

        /* 历史记录 */
        .history-section {
            max-width: 600px;
            margin: 40px auto;
            padding: 20px;
            background: rgba(10, 10, 30, 0.5);
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.1);
            backdrop-filter: blur(5px);
        }

        .history-title {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.4rem;
            text-align: center;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.3);
        }

        .history-list {
            max-height: 180px;
            overflow-y: auto;
            padding: 10px;
        }

        .history-item {
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-left: 3px solid #ffd700;
            animation: slideIn 0.4s ease;
            transition: transform 0.2s;
        }

        .history-item:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.1);
        }

        .history-time {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 5px;
        }

        .history-question {
            color: #a0a0c0;
            font-style: italic;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .history-answer {
            color: #ffd700;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .history-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 8px;
            vertical-align: middle;
            text-align: center;
            line-height: 20px;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 50%;
            font-size: 0.8rem;
        }

        .empty-history {
            text-align: center;
            color: #666;
            padding: 20px;
            font-style: italic;
        }

        /* 状态指示器 */
        .location-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 0.75rem;
            color: #a0a0c0;
            border: 1px solid rgba(255, 215, 0, 0.2);
            z-index: 100;
            max-width: 250px;
        }

        .location-status.error {
            border-color: rgba(255, 0, 0, 0.5);
            color: #ff6b6b;
        }

        .location-status.success {
            border-color: rgba(0, 255, 0, 0.5);
            color: #51cf66;
        }

        /* 动画 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* 滚动条 */
        .history-list::-webkit-scrollbar {
            width: 6px;
        }

        .history-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .history-list::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.5);
            border-radius: 3px;
        }

        /* 响应式 */
        @media (max-width: 768px) {
            h1 { font-size: 2.5rem; }
            .card-area { height: 380px; }
            .back-icon { font-size: 3rem; }
            .back-answer { font-size: 1.2rem; }
            .draw-btn { padding: 18px 50px; font-size: 1.2rem; min-width: 180px; min-height: 55px; }
            .celestial { height: 120px; }
            .sun { width: 80px; height: 80px; }
            .moon { width: 65px; height: 65px; }
            .astro-info { top: 10px; left: 10px; padding: 8px 12px; font-size: 0.75rem; min-width: 150px; }
            .location-status { bottom: 10px; left: 10px; font-size: 0.7rem; max-width: 200px; }
        }

        @media (max-width: 480px) {
            h1 { font-size: 2rem; }
            .subtitle { font-size: 1rem; }
            .card-area { height: 350px; max-width: 300px; }
            .back-icon { font-size: 2.5rem; }
            .back-answer { font-size: 1.1rem; }
            .front-text { font-size: 0.95rem; }
            .history-section { padding: 15px; }
            .sound-toggle { top: 10px; right: 10px; width: 35px; height: 35px; }
            .astro-info { display: none; }
            .location-status { display: none; }
            .draw-btn { padding: 16px 40px; font-size: 1.1rem; min-width: 160px; min-height: 50px; }
        }

        /* 特效提示 */
        .hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #ffd700;
            border: 1px solid rgba(255, 215, 0, 0.3);
            opacity: 0;
            animation: hintShow 3s forwards;
            animation-delay: 1s;
            z-index: 20;
            display: none;
        }

        @keyframes hintShow {
            0% { opacity: 0; transform: translate(-50%, 20px); }
            20% { opacity: 1; transform: translate(-50%, 0); }
            80% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -20px); }
        }

        /* 卡片翻转提示 */
        .flip-hint {
            font-size: 0.8rem;
            color: #888;
            margin-top: 10px;
            font-style: italic;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .card-container.flipped ~ .flip-hint {
            opacity: 1;
        }

        /* 加载状态 */
        .loading-text {
            font-size: 1.1rem;
            color: #ffd700;
            text-align: center;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* 天文状态提示 */
        .astro-message {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 15px;
            font-size: 0.9rem;
            color: #ffd700;
            border: 1px solid rgba(255, 215, 0, 0.3);
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 15;
            max-width: 80%;
            text-align: center;
            font-weight: bold;
            letter-spacing: 1px;
        }

        body.dusknight .astro-message,
        body.latenight .astro-message,
        body.predawn .astro-message {
            border-color: rgba(230, 230, 250, 0.3);
            color: #e6e6fa;
        }

        .astro-message.show {
            opacity: 1;
        }

        /* 调试面板 - 完善的调试系统 */
        .debug-panel {
            position: fixed;
            top: 60px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            color: #0f0;
            z-index: 200;
            max-width: 340px;
            border: 1px solid #0f0;
            display: none;
            line-height: 1.6;
        }

        body.debug .debug-panel {
            display: block;
        }

        .debug-title {
            color: #fff;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            border-bottom: 1px solid #0f0;
            padding-bottom: 5px;
        }

        .debug-item {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
        }

        .debug-label {
            color: #0ff;
        }

        .debug-value {
            color: #ff0;
            font-weight: bold;
        }

        /* 调试控制按钮 */
        .debug-controls {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #0f0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
        }

        .debug-btn {
            background: #0f0;
            color: #000;
            border: none;
            padding: 5px;
            font-size: 0.7rem;
            cursor: pointer;
            border-radius: 3px;
            font-weight: bold;
            transition: all 0.2s;
        }

        .debug-btn:hover {
            background: #0ff;
        }

        .debug-btn.active {
            background: #0ff !important;
            color: #000 !important;
            font-weight: bold;
        }

        /* 调试提示 */
        .debug-hint {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            color: #0f0;
            z-index: 201;
            border: 1px solid #0f0;
            opacity: 0;
            transition: opacity 0.3s;
        }

        body.debug .debug-hint {
            opacity: 1;
        }

        /* 颜色显示 */
        .color-box {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 1px solid #fff;
            margin-left: 5px;
            vertical-align: middle;
            border-radius: 2px;
        }

        /* 特别说明 */
        .debug-note {
            color: #ff0;
            font-size: 0.7rem;
            margin-top: 8px;
            padding: 5px;
            background: rgba(255, 255, 0, 0.1);
            border-radius: 3px;
            white-space: pre-line;
            line-height: 1.4;
        }

        /* 调试锁定状态指示 */
        .debug-panel.locked {
            border-color: #f00 !important;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        }

        @keyframes pulseLock {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; box-shadow: 0 0 10px rgba(255, 0, 0, 0.8); }
        }

        .debug-panel.locked .debug-title {
            animation: pulseLock 1.5s infinite;
        }

        /* 深夜和黎明的额外视觉区分 */
        body.latenight .container,
        body.predawn .container {
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
        }

        body.latenight .card-face {
            border-color: rgba(255, 215, 0, 0.3);
            box-shadow: 0 10px 40px rgba(255, 215, 0, 0.2);
        }

        body.predawn .card-face {
            border-color: rgba(150, 150, 180, 0.3);
            box-shadow: 0 10px 40px rgba(100, 100, 150, 0.2);
            filter: contrast(0.9) brightness(0.95);
        }

        body.latenight h1 {
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
        }

        body.predawn h1 {
            text-shadow: 0 0 15px rgba(150, 150, 180, 0.3);
            filter: contrast(0.9);
        }

        body.latenight .back-answer {
            color: #ffd700;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
        }

        body.predawn .back-answer {
            color: #d0d0e0;
            text-shadow: 0 0 10px rgba(150, 150, 180, 0.4);
        }

        body.latenight .draw-btn {
            background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
            box-shadow: 0 5px 25px rgba(255, 215, 0, 0.5);
        }

        body.predawn .draw-btn {
            background: linear-gradient(45deg, #a0a0c0, #c0c0d8, #a0a0c0);
            box-shadow: 0 5px 20px rgba(150, 150, 180, 0.4);
            color: #1a1a2e;
        }
    </style>
</head>
<body class="latenight">
    <!-- 天文信息面板 - 隐藏实时时间 -->
    <div class="astro-info nighttime" id="astroInfo">
        <div class="time-current" id="currentTime">--:--:--</div>
        <div class="time-period" id="timePeriod">正在获取时间</div>
        <div class="astro-times" id="astroTimes">
            <div>日出: <span id="sunriseTime">--:--</span></div>
            <div>日落: <span id="sunsetTime">--:--</span></div>
        </div>
        <div class="astro-status" id="astroStatus">等待定位</div>
    </div>

    <!-- 音效开关 -->
    <div class="sound-toggle" id="soundToggle" title="点击切换音效">🔊</div>

    <!-- 星空背景 -->
    <div class="stars" id="stars"></div>

    <!-- 日月同辉 -->
    <div class="celestial" id="celestial">
        <div class="sun" id="sun"></div>
        <div class="moon" id="moon"></div>
    </div>

    <!-- 粒子效果 -->
    <div class="particles" id="particles"></div>

    <!-- 抽卡特效 -->
    <div class="draw-effect" id="drawEffect">
        <div class="light-beam"></div>
        <div class="glow-ring"></div>
    </div>

    <!-- 主容器 -->
    <div class="container">
        <header>
            <h1>神秘答案之书</h1>
            <p class="subtitle">心中默念你的问题，点击下方抽卡</p>
            <p class="instruction">每一张卡片都蕴含着宇宙的智慧，抽卡前请静心冥想你的问题，答案将通过星辰之力显现</p>
        </header>

        <div class="card-area">
            <div class="card-container" id="cardContainer">
                <!-- 正面 -->
                <div class="card-face card-front">
                    <div class="front-symbol">
                        <div class="front-star"></div>
                    </div>
                    <div class="front-text">
                        心中默念你的问题<br>
                        然后点击抽卡按钮<br>
                        宇宙将给出答案
                    </div>
                </div>
                <!-- 背面 -->
                <div class="card-face card-back">
                    <div class="back-icon" id="cardIcon">★</div>
                    <div class="back-answer" id="cardAnswer">等待抽卡...</div>
                    <div class="back-category" id="cardCategory">-</div>
                </div>
            </div>
            <div class="flip-hint">点击卡片可翻转查看</div>
        </div>

        <button class="draw-btn" id="drawBtn">抽取答案</button>

        <div class="history-section">
            <h3 class="history-title">星辰历史</h3>
            <div class="history-list" id="historyList">
                <div class="empty-history">尚未抽取任何答案</div>
            </div>
        </div>
    </div>

    <div class="hint">提示：每张卡片都有独特的图案和含义</div>
    <div class="astro-message" id="astroMessage"></div>
    <div class="location-status" id="locationStatus">正在初始化...</div>
    
    <!-- 调试面板 -->
    <div class="debug-panel" id="debugPanel">
        <div class="debug-title">🔧 调试面板 (按D键关闭)</div>
        
        <!-- 核心状态 -->
        <div class="debug-item">
            <span class="debug-label">当前时段:</span>
            <span class="debug-value" id="debugPeriod">--</span>
        </div>
        <div class="debug-item">
            <span class="debug-label">当前时间:</span>
            <span class="debug-value" id="debugTime">--:--:--</span>
        </div>
        
        <!-- 天文时间 -->
        <div class="debug-item">
            <span class="debug-label">日出时间:</span>
            <span class="debug-value" id="debugSunrise">--:--</span>
        </div>
        <div class="debug-item">
            <span class="debug-label">日落时间:</span>
            <span class="debug-value" id="debugSunset">--:--</span>
        </div>
        
        <!-- 天体状态 -->
        <div class="debug-item">
            <span class="debug-label">太阳状态:</span>
            <span class="debug-value" id="debugSunState">隐藏</span>
        </div>
        <div class="debug-item">
            <span class="debug-label">月亮状态:</span>
            <span class="debug-value" id="debugMoonState">隐藏</span>
        </div>
        <div class="debug-item">
            <span class="debug-label">星空状态:</span>
            <span class="debug-value" id="debugStarsState">隐藏</span>
        </div>
        
        <!-- 视觉状态 -->
        <div class="debug-item">
            <span class="debug-label">背景颜色:</span>
            <span class="debug-value" id="debugBgColor">--</span>
        </div>
        <div class="debug-item">
            <span class="debug-label">最后更新:</span>
            <span class="debug-value" id="debugLastUpdate">--:--</span>
        </div>
        
        <!-- 时段说明 -->
        <div class="debug-note" id="debugNote">选择时段查看详细说明</div>
        
        <!-- 手动测试按钮 -->
        <div class="debug-controls">
            <button class="debug-btn" onclick="manualSwitch('dawn')">清晨</button>
            <button class="debug-btn" onclick="manualSwitch('noon')">中午</button>
            <button class="debug-btn" onclick="manualSwitch('dusk')">傍晚</button>
            <button class="debug-btn" onclick="manualSwitch('dusknight')">入夜</button>
            <button class="debug-btn" onclick="manualSwitch('latenight')">深夜</button>
            <button class="debug-btn" onclick="manualSwitch('predawn')">黎明</button>
            <button class="debug-btn" onclick="toggleLock()" id="lockBtn" style="grid-column: span 2; background: #ff0; color: #000;">🔓 解锁状态</button>
            <button class="debug-btn" onclick="restoreAutoMode()" style="grid-column: span 2; background: #0f0; color: #000;">🔄 恢复自动模式</button>
        </div>
    </div>

    <div class="debug-hint">按 D 键切换调试面板</div>

    <!-- 引入SunCalc库 -->
    <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>

    <script>
        // 100个答案数据（保持不变）
        const answers = [
            { text: "是的，毫无疑问", category: "肯定", icon: "●" },
            { text: "绝对不可能", category: "否定", icon: "×" },
            { text: "可能吧，但不确定", category: "模糊", icon: "?" },
            { text: "现在还不是时候", category: "时机", icon: "⏳" },
            { text: "相信你的直觉", category: "直觉", icon: "◎" },
            { text: "坚持下去，会有好结果", category: "坚持", icon: "▲" },
            { text: "放弃吧，没有意义", category: "放弃", icon: "■" },
            { text: "换个角度思考", category: "视角", icon: "↻" },
            { text: "等待时机，不要着急", category: "耐心", icon: "🕒" },
            { text: "这是一个好兆头", category: "吉兆", icon: "◆" },
            { text: "前方有障碍，需谨慎", category: "警示", icon: "⚠" },
            { text: "会有惊喜等着你", category: "惊喜", icon: "◈" },
            { text: "不要被表象迷惑", category: "真相", icon: "◉" },
            { text: "跟随你的心", category: "内心", icon: "♥" },
            { text: "结果比预期的好", category: "乐观", icon: "☀" },
            { text: "需要更多努力", category: "努力", icon: "🔥" },
            { text: "注意身边的人", category: "人际", icon: "👥" },
            { text: "旅途比目的地更重要", category: "过程", icon: "🚶" },
            { text: "答案就在你心中", category: "自省", icon: "◎" },
            { text: "时间会证明一切", category: "时间", icon: "⏱" },
            { text: "冒险是值得的", category: "冒险", icon: "✈" },
            { text: "保守为上策", category: "谨慎", icon: "🛡" },
            { text: "改变方向，会有新发现", category: "改变", icon: "⇄" },
            { text: "过去的事就让它过去", category: "放下", icon: "✈" },
            { text: "准备好迎接变化", category: "变化", icon: "⚡" },
            { text: "寻求帮助并不羞耻", category: "求助", icon: "⇄" },
            { text: "你的努力会被看见", category: "认可", icon: "👁" },
            { text: "保持耐心，静待花开", category: "耐心", icon: "❀" },
            { text: "机遇就在眼前", category: "机遇", icon: "✦" },
            { text: "不要被恐惧支配", category: "勇气", icon: "⚡" },
            { text: "相信自己的能力", category: "自信", icon: "▲" },
            { text: "学习放手也是一种智慧", category: "智慧", icon: "☯" },
            { text: "新的开始即将来临", category: "新生", icon: "🌱" },
            { text: "保持开放的心态", category: "开放", icon: "🔓" },
            { text: "倾听内心的声音", category: "倾听", icon: "◎" },
            { text: "保护好自己的能量", category: "能量", icon: "⚡" },
            { text: "顺其自然", category: "自然", icon: "🍃" },
            { text: "行动胜于空谈", category: "行动", icon: "→" },
            { text: "珍惜当下", category: "当下", icon: "⏳" },
            { text: "放下执念", category: "解脱", icon: "✂" },
            { text: "你的选择是正确的", category: "正确", icon: "✓" },
            { text: "需要更多信息", category: "信息", icon: "◆" },
            { text: "答案在风中飘", category: "神秘", icon: "~" },
            { text: "是时候做决定了", category: "决定", icon: "◎" },
            { text: "保持低调，观察形势", category: "观察", icon: "◉" },
            { text: "信任你的伙伴", category: "信任", icon: "⇄" },
            { text: "健康比什么都重要", category: "健康", icon: "♥" },
            { text: "金钱不是万能的", category: "价值观", icon: "$" },
            { text: "知识就是力量", category: "知识", icon: "※" },
            { text: "爱是最高的智慧", category: "爱", icon: "♥" },
            { text: "平衡是生活的艺术", category: "平衡", icon: "⚖" },
            { text: "沉默有时是最好的回答", category: "沉默", icon: "..." },
            { text: "勇气会带来好运", category: "勇气", icon: "⚡" },
            { text: "小事也能改变大局", category: "细节", icon: "●" },
            { text: "不要忽视细节", category: "细节", icon: "◉" },
            { text: "灵感来自自然", category: "灵感", icon: "🌿" },
            { text: "保持谦逊，继续学习", category: "谦逊", icon: "▼" },
            { text: "你的潜力无限", category: "潜力", icon: "∞" },
            { text: "过去的经验是财富", category: "经验", icon: "◆" },
            { text: "家庭是最重要的", category: "家庭", icon: "■" },
            { text: "微笑面对困难", category: "乐观", icon: "☀" },
            { text: "善意会回到你身边", category: "善意", icon: "↺" },
            { text: "旅行会带来启示", category: "旅行", icon: "✈" },
            { text: "尝试新事物", category: "尝试", icon: "✦" },
            { text: "保持好奇心", category: "好奇", icon: "?" },
            { text: "艺术能治愈心灵", category: "艺术", icon: "※" },
            { text: "分享带来快乐", category: "分享", icon: "⇄" },
            { text: "独处也很重要", category: "独处", icon: "◎" },
            { text: "大自然有答案", category: "自然", icon: "🌲" },
            { text: "音乐是心灵的良药", category: "音乐", icon: "♪" },
            { text: "阅读使人明智", category: "阅读", icon: "¶" },
            { text: "运动带来活力", category: "运动", icon: "⚡" },
            { text: "休息是为了走更远的路", category: "休息", icon: "☾" },
            { text: "简单的快乐最珍贵", category: "简单", icon: "○" },
            { text: "给予就是获得", category: "给予", icon: "⇄" },
            { text: "宽恕他人也是解放自己", category: "宽恕", icon: "✈" },
            { text: "保持童心", category: "童心", icon: "◆" },
            { text: "想象力创造现实", category: "想象", icon: "◈" },
            { text: "感恩带来富足", category: "感恩", icon: "※" },
            { text: "善意比聪明更重要", category: "善良", icon: "♥" },
            { text: "你的价值不由他人定义", category: "自尊", icon: "▲" },
            { text: "每一天都是新机会", category: "希望", icon: "☀" },
            { text: "改变从自己开始", category: "改变", icon: "↻" },
            { text: "倾听比说话更重要", category: "倾听", icon: "◎" },
            { text: "真诚最有力量", category: "真诚", icon: "★" },
            { text: "保持真实，自有共鸣", category: "真实", icon: "◉" },
            { text: "你的旅程独一无二", category: "独特", icon: "✦" },
            { text: "成长需要不适", category: "成长", icon: "↑" },
            { text: "失败是必经之路", category: "失败", icon: "▼" },
            { text: "专注当下", category: "专注", icon: "◎" },
            { text: "减少欲望，增加满足", category: "知足", icon: "△" },
            { text: "善良是超能力", category: "善良", icon: "♥" },
            { text: "内心平静是终极财富", category: "平静", icon: "☯" },
            { text: "你是完整的，无需外求", category: "完整", icon: "●" },
            { text: "时间会给你答案", category: "时间", icon: "⏳" },
            { text: "沉默是金", category: "沉默", icon: "..." },
            { text: "行动比语言更有力", category: "行动", icon: "→" },
            { text: "保持希望之火", category: "希望", icon: "🔥" },
            { text: "每个结束都是新开始", category: "循环", icon: "↻" },
            { text: "相信直觉的力量", category: "直觉", icon: "◎" },
            { text: "耐心是最大的美德", category: "耐心", icon: "⏳" },
            { text: "改变视角，改变世界", category: "视角", icon: "⇄" },
            { text: "内心的平静最重要", category: "平静", icon: "☯" },
            { text: "智慧来自经验", category: "智慧", icon: "◆" },
            { text: "保持谦卑，持续学习", category: "谦逊", icon: "▼" },
            { text: "你的道路由你决定", category: "选择", icon: "◎" },
            { text: "勇气战胜一切", category: "勇气", icon: "⚡" },
            { text: "爱是最强的魔法", category: "爱", icon: "♥" },
            { text: "保持平衡的生活", category: "平衡", icon: "⚖" },
            { text: "简单即是美", category: "简单", icon: "○" },
            { text: "自然会指引你", category: "自然", icon: "🌿" },
            { text: "相信宇宙的安排", category: "信任", icon: "★" },
            { text: "每一天都是礼物", category: "感恩", icon: "🎁" },
            { text: "你的选择塑造你", category: "选择", icon: "◈" },
            { text: "保持开放，保持成长", category: "成长", icon: "↑" },
            { text: "内心的智慧是你的指南", category: "智慧", icon: "◎" },
            { text: "耐心等待，必有回响", category: "耐心", icon: "⏳" },
            { text: "改变从认知开始", category: "改变", icon: "↻" },
            { text: "倾听，理解，行动", category: "行动", icon: "→" },
            { text: "真诚是最美的语言", category: "真诚", icon: "★" },
            { text: "保持真实，保持独特", category: "真实", icon: "◉" },
            { text: "你的旅程充满意义", category: "意义", icon: "◆" },
            { text: "成长需要勇气", category: "成长", icon: "⚡" },
            { text: "失败是成功的阶梯", category: "失败", icon: "▲" },
            { text: "专注，然后突破", category: "专注", icon: "◎" },
            { text: "知足常乐", category: "知足", icon: "△" },
            { text: "善良改变世界", category: "善良", icon: "♥" },
            { text: "平静是最大的力量", category: "平静", icon: "☯" },
            { text: "你本就完整", category: "完整", icon: "●" }
        ];

        // DOM元素
        const cardContainer = document.getElementById('cardContainer');
        const drawBtn = document.getElementById('drawBtn');
        const cardIcon = document.getElementById('cardIcon');
        const cardAnswer = document.getElementById('cardAnswer');
        const cardCategory = document.getElementById('cardCategory');
        const historyList = document.getElementById('historyList');
        const drawEffect = document.getElementById('drawEffect');
        const particlesContainer = document.getElementById('particles');
        const starsContainer = document.getElementById('stars');
        const soundToggle = document.getElementById('soundToggle');
        const celestial = document.getElementById('celestial');
        const sun = document.getElementById('sun');
        const moon = document.getElementById('moon');
        const currentTimeEl = document.getElementById('currentTime');
        const timePeriodEl = document.getElementById('timePeriod');
        const sunriseTimeEl = document.getElementById('sunriseTime');
        const sunsetTimeEl = document.getElementById('sunsetTime');
        const astroStatusEl = document.getElementById('astroStatus');
        const astroMessage = document.getElementById('astroMessage');
        const locationStatus = document.getElementById('locationStatus');
        const astroInfo = document.getElementById('astroInfo');
        const debugPanel = document.getElementById('debugPanel');

        // 调试元素
        const debugPeriod = document.getElementById('debugPeriod');
        const debugTime = document.getElementById('debugTime');
        const debugSunrise = document.getElementById('debugSunrise');
        const debugSunset = document.getElementById('debugSunset');
        const debugSunState = document.getElementById('debugSunState');
        const debugMoonState = document.getElementById('debugMoonState');
        const debugStarsState = document.getElementById('debugStarsState');
        const debugBgColor = document.getElementById('debugBgColor');
        const debugLastUpdate = document.getElementById('debugLastUpdate');
        const debugNote = document.getElementById('debugNote');

        // 天文数据
        let astroData = {
            sunrise: null,
            sunset: null,
            location: null,
            currentPeriod: null,
            lastUpdate: null
        };

        // 历史记录数组
        let history = [];

        // 调试锁定状态
        let isDebugLocked = false;

        // 音效管理器
        class SoundManager {
            constructor() {
                this.audioContext = null;
                this.enabled = true;
                this.initAudioContext();
            }

            initAudioContext() {
                document.addEventListener('click', () => {
                    if (!this.audioContext) {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    }
                }, { once: true });
            }

            toggle() {
                this.enabled = !this.enabled;
                const toggle = document.getElementById('soundToggle');
                toggle.textContent = this.enabled ? '🔊' : '🔇';
                toggle.classList.toggle('muted', !this.enabled);
            }

            play(category) {
                if (!this.enabled || !this.audioContext) return;
                const now = this.audioContext.currentTime;
                const osc = this.audioContext.createOscillator();
                const gain = this.audioContext.createGain();
                osc.frequency.value = 440;
                osc.type = 'sine';
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                osc.connect(gain);
                gain.connect(this.audioContext.destination);
                osc.start(now);
                osc.stop(now + 0.2);
            }
        }

        // 初始化音效管理器
        const soundManager = new SoundManager();

        // 初始化星空背景
        function createStars() {
            const starCount = 150;
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                const size = Math.random() * 2 + 0.5;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 5}s`;
                star.style.animationDuration = `${2 + Math.random() * 3}s`;
                starsContainer.appendChild(star);
            }
        }

        // 创建粒子效果
        function createParticles() {
            const particleCount = 30;
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                const size = Math.random() * 4 + 1;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.animationDelay = `${Math.random() * 15}s`;
                particle.style.animationDuration = `${15 + Math.random() * 10}s`;
                particlesContainer.appendChild(particle);
            }
        }

        // 获取用户位置并计算日出日落时间
        function initAstronomy() {
            locationStatus.textContent = "正在获取位置信息...";
            locationStatus.className = "location-status";

            if (!navigator.geolocation) {
                locationStatus.textContent = "浏览器不支持定位，使用默认位置";
                locationStatus.className = "location-status error";
                calculateSunTimes(39.9042, 116.4074);
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    astroData.location = { lat, lon };
                    locationStatus.textContent = `定位成功: ${lat.toFixed(2)}, ${lon.toFixed(2)}`;
                    locationStatus.className = "location-status success";
                    calculateSunTimes(lat, lon);
                },
                (error) => {
                    locationStatus.textContent = "定位失败，使用默认位置";
                    locationStatus.className = "location-status error";
                    calculateSunTimes(39.9042, 116.4074);
                },
                { enableHighAccuracy: true, timeout: 10000 }
            );
        }

        // 计算日出日落时间
        function calculateSunTimes(lat, lon) {
            const now = new Date();
            
            if (typeof SunCalc !== 'undefined') {
                const times = SunCalc.getTimes(now, lat, lon);
                astroData.sunrise = times.sunrise;
                astroData.sunset = times.sunset;
                locationStatus.textContent += " | 精确模式";
                
                // 显示动态时段划分提示
                const sunriseHour = astroData.sunrise.getHours();
                const sunsetHour = astroData.sunset.getHours();
                showAstroMessage(`📊 动态时段：日出 ${sunriseHour}点，日落 ${sunsetHour}点`);
            } else {
                astroData.sunrise = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 6, 0);
                astroData.sunset = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 18, 0);
                locationStatus.textContent += " | 简化模式";
                showAstroMessage('⚠️ 未加载SunCalc，使用默认6:00-18:00');
            }

            updateAstroDisplay();
            
            // 启动定时检查
            setInterval(updateTimeBasedPeriod, 1000);
            
            // 立即更新一次
            updateTimeBasedPeriod();
        }

        // 更新天文信息显示
        function updateAstroDisplay() {
            if (astroData.sunrise && astroData.sunset) {
                sunriseTimeEl.textContent = formatTime(astroData.sunrise);
                sunsetTimeEl.textContent = formatTime(astroData.sunset);
                debugSunrise.textContent = formatTime(astroData.sunrise);
                debugSunset.textContent = formatTime(astroData.sunset);
            }
        }

        // 显示天文消息（增强版）
        function showAstroMessage(text) {
            astroMessage.textContent = text;
            astroMessage.classList.add('show');
            setTimeout(() => {
                astroMessage.classList.remove('show');
            }, 3000);
        }

        // 获取时段中文名
        function getPeriodName(period) {
            const names = {
                'dawn': '清晨',
                'noon': '中午',
                'dusk': '傍晚',
                'dusknight': '入夜',
                'latenight': '深夜',
                'predawn': '黎明'
            };
            return names[period] || period;
        }

        // 核心逻辑：根据时间更新时段和主题（动态时间版）
        function updateTimeBasedPeriod() {
            if (!astroData.sunrise || !astroData.sunset) return;
            
            // 如果调试锁定，则跳过自动更新
            if (isDebugLocked) {
                // 仍然更新时间显示，但不改变时段
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const seconds = now.getSeconds().toString().padStart(2, '0');
                debugTime.textContent = `${hours}:${minutes}:${seconds}`;
                return;
            }

            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentTime = currentHour * 60 + currentMinute;
            
            // 获取日出日落的小时和分钟
            const sunriseHour = astroData.sunrise.getHours();
            const sunriseMinute = astroData.sunrise.getMinutes();
            const sunsetHour = astroData.sunset.getHours();
            const sunsetMinute = astroData.sunset.getMinutes();
            
            const sunriseTime = sunriseHour * 60 + sunriseMinute;
            const sunsetTime = sunsetHour * 60 + sunsetMinute;
            
            // 动态计算六个时段（基于日出日落时间）
            // 时段划分：
            // - 黎明（Predawn）：日出前2小时到日出
            // - 清晨（Dawn）：日出到日出后2小时
            // - 中午（Noon）：日出后2小时到日落前2小时
            // - 傍晚（Dusk）：日落前2小时到日落
            // - 入夜（Dusknight）：日落到日落后2小时
            // - 深夜（Latenight）：日落后2小时到日出前2小时
            
            const predawnStart = (sunriseTime - 120 + 1440) % 1440; // 日出前2小时
            const dawnStart = sunriseTime;
            const dawnEnd = sunriseTime + 120;
            const noonEnd = sunsetTime - 120;
            const duskStart = sunsetTime - 120;
            const duskEnd = sunsetTime;
            const dusknightEnd = sunsetTime + 120;
            
            let newPeriod;
            
            if (currentTime >= predawnStart && currentTime < dawnStart) {
                newPeriod = 'predawn';
            } else if (currentTime >= dawnStart && currentTime < dawnEnd) {
                newPeriod = 'dawn';
            } else if (currentTime >= dawnEnd && currentTime < noonEnd) {
                newPeriod = 'noon';
            } else if (currentTime >= duskStart && currentTime < duskEnd) {
                newPeriod = 'dusk';
            } else if (currentTime >= duskEnd && currentTime < dusknightEnd) {
                newPeriod = 'dusknight';
            } else {
                newPeriod = 'latenight';
            }

            // 只在时段改变时更新
            if (newPeriod !== astroData.currentPeriod) {
                astroData.currentPeriod = newPeriod;
                astroData.lastUpdate = now;
                
                // 先清理状态
                cleanupCelestial();
                
                // 再更新主题
                updatePeriodTheme(newPeriod);
                showPeriodMessage(newPeriod);
                
                // 更新调试信息
                updateDebugInfo();
            }

            // 每秒更新时间显示
            updateTimeDisplay(now, newPeriod);
            
            // 每10秒更新调试信息（如果启用）
            if (document.body.classList.contains('debug') && now.getSeconds() % 10 === 0) {
                updateDebugInfo();
            }
        }

        // 清理天体状态
        function cleanupCelestial() {
            sun.style.opacity = '0';
            sun.style.visibility = 'hidden';
            moon.style.opacity = '0';
            moon.style.visibility = 'hidden';
            celestial.offsetHeight; // 触发重排
        }

        // 更新时段主题
        function updatePeriodTheme(period) {
            // 设置body类名
            document.body.className = period;
            
            // 根据时段显示对应天体
            const isDay = ['dawn', 'noon', 'dusk'].includes(period);
            
            if (isDay) {
                astroInfo.className = 'astro-info';
                astroStatusEl.style.background = "rgba(255, 215, 0, 0.2)";
                
                // 太阳显示，月亮隐藏
                setTimeout(() => {
                    sun.style.opacity = '1';
                    sun.style.visibility = 'visible';
                    moon.style.opacity = '0';
                    moon.style.visibility = 'hidden';
                }, 50);
                
            } else {
                astroInfo.className = 'astro-info night';
                astroStatusEl.style.background = "rgba(230, 230, 250, 0.2)";
                
                // 月亮显示，太阳隐藏
                setTimeout(() => {
                    moon.style.opacity = '1';
                    moon.style.visibility = 'visible';
                    sun.style.opacity = '0';
                    sun.style.visibility = 'hidden';
                }, 50);
            }
            
            // 更新状态文本
            const periodNames = {
                'dawn': '🌅 清晨 (动态)',
                'noon': '☀️ 中午 (动态)',
                'dusk': '🌆 傍晚 (动态)',
                'dusknight': '🌃 入夜 (动态)',
                'latenight': '🌙 深夜 (动态)',
                'predawn': '🌄 黎明 (动态)'
            };
            
            astroStatusEl.textContent = periodNames[period] || period;
        }

        // 显示时段切换消息
        function showPeriodMessage(period) {
            const messages = {
                'dawn': '🌅 清晨已至，万物复苏',
                'noon': '☀️ 正午时分，阳光普照',
                'dusk': '🌆 黄昏降临，暮色四合',
                'dusknight': '🌃 夜幕降临，星光初现',
                'latenight': '🌙 深夜时分，万籁俱寂',
                'predawn': '🌄 黎明前的宁静时刻'
            };
            
            astroMessage.textContent = messages[period];
            astroMessage.classList.add('show');
            
            setTimeout(() => {
                astroMessage.classList.remove('show');
            }, 3000);
        }

        // 更新时间显示（仅调试用）
        function updateTimeDisplay(now, period) {
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            // 只更新调试面板的时间
            debugTime.textContent = `${hours}:${minutes}:${seconds}`;
            
            const periodNames = {
                'dawn': '清晨',
                'noon': '中午',
                'dusk': '傍晚',
                'dusknight': '入夜',
                'latenight': '深夜',
                'predawn': '黎明'
            };
            
            debugPeriod.textContent = periodNames[period] || '--';
        }

        // 更新时段说明（动态时间版）
        function updatePeriodNote(period) {
            if (!astroData.sunrise || !astroData.sunset) {
                debugNote.textContent = '等待获取日出日落时间...';
                return;
            }
            
            const sunriseHour = astroData.sunrise.getHours();
            const sunriseMinute = astroData.sunrise.getMinutes();
            const sunsetHour = astroData.sunset.getHours();
            const sunsetMinute = astroData.sunset.getMinutes();
            
            const predawnStart = `${((sunriseHour - 2 + 24) % 24).toString().padStart(2, '0')}:${(sunriseMinute).toString().padStart(2, '0')}`;
            const dawnEnd = `${((sunriseHour + 2) % 24).toString().padStart(2, '0')}:${(sunriseMinute).toString().padStart(2, '0')}`;
            const noonEnd = `${((sunsetHour - 2 + 24) % 24).toString().padStart(2, '0')}:${(sunsetMinute).toString().padStart(2, '0')}`;
            const duskStart = `${((sunsetHour - 2 + 24) % 24).toString().padStart(2, '0')}:${(sunsetMinute).toString().padStart(2, '0')}`;
            const dusknightEnd = `${((sunsetHour + 2) % 24).toString().padStart(2, '0')}:${(sunsetMinute).toString().padStart(2, '0')}`;
            
            const lockStatus = isDebugLocked ? '🔒 已锁定' : '🔓 已解锁';
            
            const notes = {
                'dawn': `【清晨】${sunriseHour}:${sunriseMinute.toString().padStart(2, '0')} - ${dawnEnd}\n太阳初升，位于左侧`,
                'noon': `【中午】${dawnEnd} - ${noonEnd}\n太阳高照，位于正中`,
                'dusk': `【傍晚】${duskStart} - ${sunsetHour}:${sunsetMinute.toString().padStart(2, '0')}\n夕阳西下，位于右侧`,
                'dusknight': `【入夜】${sunsetHour}:${sunsetMinute.toString().padStart(2, '0')} - ${dusknightEnd}\n月亮初现，位于右侧，星空显现`,
                'latenight': `【深夜】${dusknightEnd} - ${predawnStart}\n月亮高悬，位于正中，星空璀璨`,
                'predawn': `【黎明】${predawnStart} - ${sunriseHour}:${sunriseMinute.toString().padStart(2, '0')}\n月亮渐隐，位于左侧，星空将逝`
            };
            
            debugNote.innerHTML = `状态：${lockStatus}<br>${notes[period] || '选择时段查看详细说明'}`;
        }

        // 更新调试信息（增强版）
        function updateDebugInfo() {
            if (!document.body.classList.contains('debug')) return;
            
            // 太阳状态
            const sunOpacity = window.getComputedStyle(sun).opacity;
            const sunVisible = sunOpacity > '0' && window.getComputedStyle(sun).visibility !== 'hidden';
            debugSunState.textContent = sunVisible ? `显示 (透明度:${parseFloat(sunOpacity).toFixed(2)})` : '隐藏';
            
            // 月亮状态
            const moonOpacity = window.getComputedStyle(moon).opacity;
            const moonVisible = moonOpacity > '0' && window.getComputedStyle(moon).visibility !== 'hidden';
            debugMoonState.textContent = moonVisible ? `显示 (透明度:${parseFloat(moonOpacity).toFixed(2)})` : '隐藏';
            
            // 星空状态
            const starsOpacity = window.getComputedStyle(starsContainer).opacity;
            const starsVisible = starsOpacity > '0' && window.getComputedStyle(starsContainer).visibility !== 'hidden';
            debugStarsState.textContent = starsVisible ? `显示 (透明度:${parseFloat(starsOpacity).toFixed(2)})` : '隐藏';
            
            // 背景颜色
            const bgColor = window.getComputedStyle(document.body).background;
            debugBgColor.innerHTML = `${bgColor.substring(0, 30)}... <span class="color-box" style="background:${bgColor.includes('gradient') ? 'linear-gradient(45deg, #2c1b47, #ffd700)' : bgColor.match(/#[a-f0-9]{6}/i)?.[0] || '#000'}"></span>`;
            
            // 最后更新时间
            debugLastUpdate.textContent = astroData.lastUpdate ? formatTime(astroData.lastUpdate) : '无';
            
            // 时段说明
            updatePeriodNote(astroData.currentPeriod);
        }

        // 手动切换时段（调试用）
        function manualSwitch(period) {
            if (!document.body.classList.contains('debug')) {
                alert('请先按D键开启调试模式');
                return;
            }
            
            // 强制锁定
            isDebugLocked = true;
            const lockBtn = document.getElementById('lockBtn');
            lockBtn.textContent = '🔒 已锁定';
            lockBtn.style.background = '#f00';
            lockBtn.style.color = '#fff';
            debugPanel.classList.add('locked');
            
            astroData.currentPeriod = period;
            astroData.lastUpdate = new Date();
            cleanupCelestial();
            updatePeriodTheme(period);
            showPeriodMessage(period);
            updateDebugInfo();
            
            // 高亮当前按钮
            const buttons = document.querySelectorAll('.debug-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            showAstroMessage(`🔧 手动切换至：${getPeriodName(period)} (已锁定)`);
        }

        // 切换锁定状态
        function toggleLock() {
            isDebugLocked = !isDebugLocked;
            const lockBtn = document.getElementById('lockBtn');
            
            if (isDebugLocked) {
                lockBtn.textContent = '🔒 已锁定';
                lockBtn.style.background = '#f00';
                lockBtn.style.color = '#fff';
                debugPanel.classList.add('locked');
                showAstroMessage('🔒 调试模式已锁定，时段不会自动切换');
            } else {
                lockBtn.textContent = '🔓 解锁状态';
                lockBtn.style.background = '#ff0';
                lockBtn.style.color = '#000';
                debugPanel.classList.remove('locked');
                showAstroMessage('🔓 调试模式已解锁，恢复自动切换');
            }
        }

        // 恢复自动模式
        function restoreAutoMode() {
            isDebugLocked = false;
            const lockBtn = document.getElementById('lockBtn');
            lockBtn.textContent = '🔓 解锁状态';
            lockBtn.style.background = '#ff0';
            lockBtn.style.color = '#000';
            debugPanel.classList.remove('locked');
            
            // 清除所有按钮高亮
            const buttons = document.querySelectorAll('.debug-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            showAstroMessage('🔄 已恢复自动时间模式');
        }

        // 格式化时间
        function formatTime(date) {
            if (!date) return '--:--';
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // 抽卡函数
        function drawCard() {
            drawBtn.disabled = true;
            playDrawEffect();

            cardContainer.classList.remove('flipped');
            cardAnswer.textContent = "正在解读星辰...";
            cardCategory.textContent = "占卜中";
            cardIcon.textContent = "✦";

            setTimeout(() => {
                const randomIndex = Math.floor(Math.random() * answers.length);
                const selectedAnswer = answers[randomIndex];

                cardAnswer.textContent = selectedAnswer.text;
                cardCategory.textContent = selectedAnswer.category;
                cardIcon.textContent = selectedAnswer.icon;

                cardContainer.classList.add('flipped');
                addToHistory(selectedAnswer);

                soundManager.play(selectedAnswer.category);
                drawBtn.disabled = false;
            }, 1500);
        }

        // 播放抽卡特效
        function playDrawEffect() {
            drawEffect.classList.add('active');

            for (let i = 0; i < 20; i++) {
                const sparkle = document.createElement('div');
                sparkle.style.position = 'absolute';
                sparkle.style.width = '4px';
                sparkle.style.height = '4px';
                sparkle.style.background = '#ffd700';
                sparkle.style.borderRadius = '50%';
                sparkle.style.boxShadow = '0 0 10px #ffd700';
                sparkle.style.left = '50%';
                sparkle.style.top = '50%';
                sparkle.style.transform = `translate(-50%, -50%) rotate(${Math.random() * 360}deg) translateX(${50 + Math.random() * 100}px)`;
                sparkle.style.animation = `sparkleFade ${0.5 + Math.random() * 0.5}s ease-out forwards`;
                drawEffect.appendChild(sparkle);

                setTimeout(() => {
                    if (sparkle.parentNode) {
                        sparkle.parentNode.removeChild(sparkle);
                    }
                }, 1000);
            }

            setTimeout(() => {
                drawEffect.classList.remove('active');
            }, 1000);

            if (!document.getElementById('sparkleStyle')) {
                const style = document.createElement('style');
                style.id = 'sparkleStyle';
                style.textContent = `
                    @keyframes sparkleFade {
                        0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                        100% { opacity: 0; transform: translate(-50%, -50%) scale(0); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // 添加到历史记录
        function addToHistory(answer) {
            const historyItem = {
                icon: answer.icon,
                category: answer.category,
                answer: answer.text,
                timestamp: new Date()
            };

            history.unshift(historyItem);
            if (history.length > 10) history.pop();
            updateHistoryDisplay();
        }

        // 更新历史记录显示
        function updateHistoryDisplay() {
            if (history.length === 0) {
                historyList.innerHTML = '<div class="empty-history">尚未抽取任何答案</div>';
                return;
            }

            historyList.innerHTML = '';
            history.forEach(item => {
                const historyItemDiv = document.createElement('div');
                historyItemDiv.classList.add('history-item');
                const timeStr = item.timestamp.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
                historyItemDiv.innerHTML = `
                    <div class="history-time">${timeStr}</div>
                    <div class="history-question">问题</div>
                    <div class="history-answer">
                        <span class="history-icon">${item.icon}</span>
                        ${item.answer}
                    </div>
                `;
                historyList.appendChild(historyItemDiv);
            });
        }

        // 事件监听
        drawBtn.addEventListener('click', drawCard);
        cardContainer.addEventListener('click', () => {
            if (cardContainer.classList.contains('flipped')) {
                cardContainer.classList.remove('flipped');
            } else {
                if (cardAnswer.textContent !== "等待抽卡..." && cardAnswer.textContent !== "正在解读星辰...") {
                    cardContainer.classList.add('flipped');
                }
            }
        });

        soundToggle.addEventListener('click', () => {
            soundManager.toggle();
        });

        // 按D键切换调试模式
        document.addEventListener('keydown', (e) => {
            if (e.key.toLowerCase() === 'd') {
                document.body.classList.toggle('debug');
                if (document.body.classList.contains('debug')) {
                    updateDebugInfo();
                }
            }
        });

        // 初始化
        window.addEventListener('DOMContentLoaded', () => {
            createStars();
            createParticles();
            initAstronomy();

            setTimeout(() => {
                const hint = document.querySelector('.hint');
                if (hint) hint.style.display = 'block';
            }, 2000);
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>新年祝福</title>
  <style>
    :root{
      --bg1:#f4f4f5;
      --bg2:#e5e7eb;
      --text:#0f172a;
      --muted:#6b7280;
    }
    *{box-sizing:border-box}
    html,body{height:100%;width:100%}
    body{
      margin:0;
      font-family:"YouYuan","Comic Sans MS","STKaiti","KaiTi","Microsoft YaHei",sans-serif;
      color:var(--text);
      background:linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
      min-height:100svh;
      overflow:hidden;
    }

    .starfield{display:none}
    .glow-orb{display:none}

    .scene{
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      height:100svh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      opacity:0;
      visibility:hidden;
      transform:translateY(14px);
      transition:opacity 1.2s ease, transform 1.2s ease;
      pointer-events:none;
      padding:28px 18px;
    }
    .scene.active{
      opacity:1;
      visibility:visible;
      transform:translateY(0);
      pointer-events:auto;
    }
    .scene.hidden{display:none}
    .scene.exiting{
      pointer-events:none;
    }
    .scene.exiting .panel,
    .scene.exiting .scene-3-wrap,
    .scene.exiting .message-card{
      animation:blowAway 2.8s ease forwards;
    }

    .scene.light{
      color:#1f2937;
    }
    .scene.light::before{
      content:"";
      position:fixed;
      inset:0;
      background:linear-gradient(180deg, #f8fafc, #e5e7eb);
      z-index:0;
    }
    .scene.light .message-card{z-index:1}

    .scene.final{
      position:fixed;
    }
    .scene.final::before{
      content:"";
      position:fixed;
      inset:0;
      background:linear-gradient(180deg, #f4f4f5, #e5e7eb);
      z-index:0;
      transition:background 1.6s ease;
    }
    .scene.final.red::before{
      background:linear-gradient(180deg, #b91c1c, #ef4444);
    }
    .scene.final .scene-3-wrap{z-index:2}

    .fireworks{display:none}

    .scene.gray2025::before{
      content:"";
      position:fixed;
      inset:0;
      background:linear-gradient(180deg, #f4f4f5, #e5e7eb);
      z-index:0;
    }
    .scene.gray2025 .scene-3-wrap{z-index:1}

    @keyframes blowAway{
      to{
        transform:translate(90px,-60px) rotate(7deg);
        opacity:0;
        filter:blur(7px);
      }
    }

    .title{
      font-size:clamp(28px,5.5vw,52px);
      letter-spacing:6px;
      margin:0 0 12px;
      text-shadow:none;
    }
    .title.red{color:#ef4444}
    .subtitle{
      font-size:clamp(16px,3.2vw,22px);
      color:var(--muted);
      letter-spacing:2px;
      margin:8px 0 28px;
    }

    .fade-line{
      opacity:0;
      filter:blur(2px);
      transform:translateY(10px);
      animation:fadeIn 2.8s ease forwards;
    }
    .fade-line.delay-1{animation-delay:1s}
    .fade-line.delay-2{animation-delay:2s}
    .fade-line.delay-3{animation-delay:3s}

    @keyframes fadeIn{
      to{opacity:1;filter:blur(0);transform:translateY(0)}
    }

    .panel{
      background:transparent;
      border:none;
      border-radius:0;
      padding:0;
      box-shadow:none;
      backdrop-filter:none;
      max-width:620px;
      width:min(94vw,620px);
      text-align:center;
      display:flex;
      flex-direction:column;
      align-items:center;
    }

    input{
      font-family:inherit;
      font-size:18px;
      padding:10px 14px;
      height:44px;
      border-radius:12px;
      border:1px solid rgba(15,23,42,.2);
      background:#ffffff;
      color:#0f172a;
      min-width:220px;
      outline:none;
      text-align:center;
    }

    button{
      font-family:inherit;
      border:none;
      cursor:pointer;
    }

    .action-btn{
      margin-top:18px;
      padding:10px 30px;
      height:44px;
      border-radius:28px;
      background:#ffffff;
      color:#1f2937;
      font-weight:700;
      box-shadow:0 10px 24px rgba(15,23,42,.08);
      transition:transform .2s ease, box-shadow .2s ease;
    }
    .action-btn:hover{transform:translateY(-2px);box-shadow:0 14px 28px rgba(15,23,42,.12)}

    .hint{
      font-size:14px;
      color:#ef4444;
      min-height:20px;
      text-align:center;
    }

    .wish-block{
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
      width:100%;
    }
    .wish-label{
      font-size:clamp(20px,4.6vw,32px);
      letter-spacing:3px;
      color:#1f2937;
    }
    .wish-list{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:8px 10px;
      width:100%;
      max-width:520px;
    }
    .wish-item{
      border:1px solid rgba(15,23,42,.15);
      background:#ffffff;
      color:#0f172a;
      border-radius:18px;
      padding:8px 12px;
      font-size:clamp(14px,3.2vw,20px);
      letter-spacing:1px;
      display:flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
      transition:transform .2s ease, border-color .2s ease, background .2s ease;
      box-shadow:none;
      margin-top:0;
      font-weight:500;
    }
    .wish-item::after{
      content:"✓";
      font-weight:700;
      opacity:0;
      color:#ef4444;
      transition:opacity .2s ease;
    }
    .wish-item.active{
      border-color:rgba(239,68,68,.7);
      background:rgba(239,68,68,.08);
      transform:translateY(-2px);
    }
    .wish-item.active::after{opacity:1}

    .wish-picked{
      font-size:14px;
      color:#6b7280;
      margin-top:6px;
      text-align:center;
    }

    .name-card{
      margin-top:14px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
      width:100%;
    }

    .name-card.horizontal{
      flex-direction:row;
    }
    .name-card.horizontal .action-btn{
      margin-top:0;
    }

    .message-card{
      font-size:clamp(14px,4vw,18px);
      padding:14px 18px;
      background:#ffffff;
      border-radius:16px;
      color:#1f2937;
      box-shadow:0 12px 28px rgba(15,23,42,.12);
      animation:fadeIn 1.6s ease forwards;
      opacity:0;
      text-align:center;
    }

    .scene-3-wrap{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:16px;
      width:100%;
      position:relative;
      padding:10px 0 28px;
    }

    .final-stack{
      width:min(92vw,720px);
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      gap:10px;
    }

    .name-line{
      font-size:clamp(18px,4vw,28px);
      letter-spacing:2px;
      color:#111827;
      position:relative;
      opacity:0;
      animation:fadeIn 1.6s ease forwards;
      text-align:left;
      display:flex;
      align-items:flex-end;
      gap:6px;
      line-height:1;
    }

    .wish-zh{
      font-size:clamp(34px,7vw,56px);
      color:#ffffff;
      font-weight:900;
      letter-spacing:2px;
      opacity:0;
      animation:flyIn 1.6s ease forwards 1.1s;
      text-shadow:none;
      background:#b91c1c;
      padding:6px 8px 4px;
      border:2px solid rgba(255,255,255,.65);
      box-shadow:0 6px 16px rgba(0,0,0,.28) inset, 0 6px 18px rgba(0,0,0,.25);
      border-radius:6px;
    }

    @keyframes flyIn{
      0%{transform:translateX(-60px) translateY(-6px) scale(.85);opacity:0}
      70%{opacity:1}
      100%{transform:translateX(0) translateY(0) scale(1);opacity:1}
    }

    .digits-stage{
      position:relative;
      width:min(92vw,720px);
      height:clamp(220px,42vh,320px);
      display:grid;
      place-items:center;
      overflow:visible;
    }

    .digits{
      position:absolute;
      inset:0;
      display:flex;
      gap:4px;
      justify-content:center;
      align-items:center;
      opacity:0;
      transform:scale(.98);
      transition:opacity 1s ease, transform 1s ease;
      padding:6px 2px;
    }
    .digits.show{opacity:1;transform:scale(1)}
    .digits.scatter-out .word,
    .digits.scatter-in .word{
      animation-delay:var(--ad,0s);
    }
    .digits.scatter-out .word{animation:scatter 1.6s ease forwards}
    .digits.scatter-in .word{animation:gather 1.8s ease forwards}

    .digit{
      width:clamp(64px,15vw,110px);
      height:clamp(140px,28vh,210px);
      display:grid;
      grid-template-columns:repeat(5,1fr);
      grid-template-rows:repeat(7,1fr);
      gap:2px;
      border-radius:12px;
    }

    .word-cell{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .word{
      font-family:"SimSun","Songti SC","STSong","Microsoft YaHei",serif;
      font-size:clamp(9px,1.35vw,13px);
      font-weight:700;
      opacity:.98;
      display:flex;
      align-items:center;
      justify-content:center;
      text-shadow:none;
      transition:color .8s ease;
      transform:translate(var(--jx,0), var(--jy,0)) rotate(var(--jr,0));
      line-height:1.12;
      letter-spacing:0;
    }
    .word.sub{
      position:absolute;
      top:54%;
      font-size:0.82em;
      opacity:.92;
    }
    .word.sub2{
      position:absolute;
      top:18%;
      font-size:0.74em;
      opacity:.8;
    }

    .digits.negative .word{color:#111827}
    .digits.negative .word.alt{color:#b91c1c}

    .digits.positive .word{
      text-shadow:none;
    }

    @keyframes scatter{
      to{
        transform:translate(var(--dx), var(--dy)) rotate(var(--rot));
        opacity:0;
        filter:blur(2px);
      }
    }
    @keyframes gather{
      from{
        transform:translate(var(--dx), var(--dy)) rotate(var(--rot));
        opacity:.1;
      }
      to{
        transform:translate(var(--jx,0), var(--jy,0)) rotate(var(--jr,0));
        opacity:.98;
      }
    }

    .caption{
      font-size:14px;
      color:#6b7280;
      letter-spacing:2px;
      text-align:center;
    }

    @media (max-width:640px){
      .panel{width:min(92vw,620px)}
      .digit{gap:2px}
      .digits{gap:4px}
      .wish-item{padding:8px 10px}
      input{min-width:200px}
    }
  </style>
</head>
<body>
  <div class="starfield"></div>
  <div class="glow-orb"></div>
  <div class="glow-orb second"></div>

  <!-- Scene 1 -->
  <section class="scene active" id="scene1">
    <div class="panel">
      <h1 class="title red fade-line">新年快乐！</h1>
      <div class="subtitle fade-line delay-1">在新的一年你有哪些美好愿景呢？</div>
      <div class="wish-block fade-line delay-2">
        <div class="wish-label">希望新一年</div>
        <div class="wish-list" id="wishList">
          <button class="wish-item is-all" data-value="all" type="button">全选</button>
          <button class="wish-item" data-value="身体健康" type="button">身体健康</button>
          <button class="wish-item" data-value="学业进步" type="button">学业进步</button>
          <button class="wish-item" data-value="事业顺利" type="button">事业顺利</button>
          <button class="wish-item" data-value="财运提升" type="button">财运提升</button>
          <button class="wish-item" data-value="家人平安" type="button">家人平安</button>
          <button class="wish-item" data-value="旅行自由" type="button">旅行自由</button>
          <button class="wish-item" data-value="爱情甜蜜" type="button">爱情甜蜜</button>
          <button class="wish-item" data-value="朋友常伴" type="button">朋友常伴</button>
          <button class="wish-item" data-value="心态安稳" type="button">心态安稳</button>
          <button class="wish-item" data-value="灵感丰沛" type="button">灵感丰沛</button>
          <button class="wish-item" data-value="自律成长" type="button">自律成长</button>
          <button class="wish-item" data-value="好事连连" type="button">好事连连</button>
        </div>
        <div class="wish-picked" id="wishPicked">未选择</div>
      </div>
      <button id="goScene2" class="action-btn fade-line delay-3" type="button">确定</button>
      <div class="hint" id="wishHint"></div>
    </div>
  </section>

  <!-- Scene 2 -->
  <section class="scene hidden" id="scene2">
    <div class="panel">
      <h2 class="title fade-line">许愿人是</h2>
      <div class="name-card horizontal fade-line delay-1">
        <input id="nameInput" type="text" maxlength="10" placeholder="请输入你的名字" />
        <button id="goScene3" class="action-btn" type="button">确定</button>
      </div>
      <div class="hint" id="nameHint"></div>
    </div>
  </section>

  <!-- Scene Message -->
  <section class="scene hidden light" id="sceneMessage">
    <div class="message-card">其实这只是个仪式，程序里面只收录了你的名字...</div>
  </section>

  <!-- Scene 3 -->
  <section class="scene hidden final" id="scene3">
    <div class="fireworks"></div>
    <div class="scene-3-wrap">
      <div class="final-stack">
        <div class="name-line" id="nameLine">
          <span class="wish-zh">祝</span>
          <span id="finalName">徐新雨</span>的
        </div>
        <div class="digits-stage">
          <div class="digits negative" id="digits2025"></div>
          <div class="digits positive" id="digits2026"></div>
        </div>
      </div>
      <div class="caption">愿所有美好，都在下一年如期而至</div>
    </div>
  </section>

  <script>
    const scene1 = document.getElementById('scene1');
    const scene2 = document.getElementById('scene2');
    const scene3 = document.getElementById('scene3');
    const sceneMessage = document.getElementById('sceneMessage');

    const wishList = document.getElementById('wishList');
    const wishHint = document.getElementById('wishHint');
    const wishPicked = document.getElementById('wishPicked');
    const nameHint = document.getElementById('nameHint');

    const digits2025 = document.getElementById('digits2025');
    const digits2026 = document.getElementById('digits2026');

    const wishButtons = Array.from(wishList.querySelectorAll('.wish-item'));
    const allButton = wishList.querySelector('.is-all');
    const wishOptions = wishButtons.filter(b => b !== allButton).map(b => b.dataset.value);

    const negativeWords = [
      '没钱','水逆','失恋','焦虑','熬夜','迷茫','拖延','孤独','瓶颈','内耗','生病','低落'
    ];

    const palette = ['#f97316','#fbbf24','#34d399','#60a5fa','#a78bfa','#f472b6','#22d3ee','#fb7185'];

    const patterns = {
      '0':[
        0,1,1,1,0,
        1,0,0,0,1,
        1,0,0,0,1,
        1,0,0,0,1,
        1,0,0,0,1,
        1,0,0,0,1,
        0,1,1,1,0
      ],
      '2':[
        0,1,1,1,0,
        1,0,0,0,1,
        0,0,0,0,1,
        0,1,1,1,0,
        1,0,0,0,0,
        1,0,0,0,0,
        1,1,1,1,1
      ],
      '5':[
        1,1,1,1,1,
        1,0,0,0,0,
        1,1,1,1,0,
        0,0,0,0,1,
        0,0,0,0,1,
        1,0,0,0,1,
        0,1,1,1,0
      ],
      '6':[
        0,1,1,1,0,
        1,0,0,0,1,
        1,0,0,0,0,
        1,1,1,1,0,
        1,0,0,0,1,
        1,0,0,0,1,
        0,1,1,1,0
      ]
    };

    function makeWordSpan(text, mode, index){
      const span = document.createElement('span');
      span.className = 'word';
      span.textContent = text;
      span.style.setProperty('--jx', `${(Math.random() * 6 - 3).toFixed(0)}px`);
      span.style.setProperty('--jy', `${(Math.random() * 6 - 3).toFixed(0)}px`);
      span.style.setProperty('--jr', `${(Math.random() * 8 - 4).toFixed(0)}deg`);
      span.style.setProperty('--ad', `${(Math.random() * 0.35).toFixed(2)}s`);
      if(mode === 'negative' && index % 2 === 1){
        span.classList.add('alt');
      }
      if(mode === 'positive'){
        span.style.color = palette[index % palette.length];
      }
      return span;
    }

    function buildDigits(container, digits, words, mode){
      container.innerHTML = '';
      let wordIndex = 0;
      digits.split('').forEach(d => {
        const digit = document.createElement('div');
        digit.className = 'digit';
        const pattern = patterns[d];
        pattern.forEach(cell => {
          const cellEl = document.createElement('div');
          cellEl.className = 'word-cell';
          if(cell === 1){
            const text = words[wordIndex % words.length];
            const spanMain = makeWordSpan(text, mode, wordIndex);
            cellEl.appendChild(spanMain);
            wordIndex++;

            if(Math.random() < 0.75){
              const text2 = words[wordIndex % words.length];
              const spanSub = makeWordSpan(text2, mode, wordIndex);
              spanSub.classList.add('sub');
              cellEl.appendChild(spanSub);
              wordIndex++;
            }

            if(Math.random() < 0.35){
              const text3 = words[wordIndex % words.length];
              const spanSub2 = makeWordSpan(text3, mode, wordIndex);
              spanSub2.classList.add('sub2');
              cellEl.appendChild(spanSub2);
              wordIndex++;
            }
          }
          digit.appendChild(cellEl);
        });
        container.appendChild(digit);
      });
    }

    function assignScatterDirectional(container, xMin, xMax, yMin, yMax){
      container.querySelectorAll('.word').forEach(w => {
        const dx = (Math.random() * (xMax - xMin) + xMin).toFixed(0);
        const dy = (Math.random() * (yMax - yMin) + yMin).toFixed(0);
        const rot = (Math.random() * 100 - 50).toFixed(0);
        w.style.setProperty('--dx', `${dx}px`);
        w.style.setProperty('--dy', `${dy}px`);
        w.style.setProperty('--rot', `${rot}deg`);
      });
    }

    let currentScene = scene1;

    function transitionTo(target){
      if(currentScene === target) return;
      const outgoing = currentScene;
      outgoing.classList.add('exiting');
      outgoing.classList.remove('active');
      setTimeout(() => {
        outgoing.classList.add('hidden');
        outgoing.classList.remove('exiting');
      }, 2800);

      target.classList.remove('hidden');
      requestAnimationFrame(() => {
        target.classList.add('active');
      });

      currentScene = target;
    }

    let selectedWishes = [];

    function updatePicked(){
      if(allButton.classList.contains('active')){
        wishPicked.textContent = '全部愿景';
        return;
      }
      if(selectedWishes.length === 0){
        wishPicked.textContent = '未选择';
        return;
      }
      wishPicked.textContent = selectedWishes.join('、');
    }

    function setAllActive(active){
      allButton.classList.toggle('active', active);
      wishButtons.filter(b => b !== allButton).forEach(b => b.classList.toggle('active', false));
      selectedWishes = active ? [...wishOptions] : [];
      updatePicked();
    }

    wishButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const value = btn.dataset.value;
        if(value === 'all'){
          setAllActive(!btn.classList.contains('active'));
          return;
        }

        if(allButton.classList.contains('active')){
          allButton.classList.remove('active');
          selectedWishes = [];
        }

        btn.classList.toggle('active');
        const activeValues = wishButtons
          .filter(b => b !== allButton && b.classList.contains('active'))
          .map(b => b.dataset.value);

        selectedWishes = activeValues;
        updatePicked();
      });
    });

    document.getElementById('goScene2').addEventListener('click', () => {
      if(selectedWishes.length === 0 && !allButton.classList.contains('active')){
        wishHint.textContent = '请至少选择一个愿景';
        return;
      }
      wishHint.textContent = '';
      if(allButton.classList.contains('active')){
        selectedWishes = [...wishOptions];
      }
      transitionTo(scene2);
    });

    document.getElementById('goScene3').addEventListener('click', () => {
      nameHint.textContent = '';
      transitionTo(sceneMessage);
      setTimeout(() => {
        transitionTo(scene3);
        startFinale();
      }, 2000);
    });

    function startFinale(){
      scene3.classList.add('gray2025');
      scene3.classList.remove('red');
      buildDigits(digits2025, '2025', negativeWords, 'negative');
      buildDigits(digits2026, '2026', selectedWishes.length ? selectedWishes : wishOptions, 'positive');

      digits2025.classList.add('show');
      digits2025.classList.remove('scatter-in','scatter-out');
      digits2026.classList.remove('show','scatter-in','scatter-out');\n      digits2026.style.opacity = '1';

      assignScatterDirectional(digits2025, -260, -120, 120, 260);
      assignScatterDirectional(digits2026, 120, 260, -260, -120);

      setTimeout(() => {
        scene3.classList.remove('gray2025');
        scene3.classList.add('red');
        digits2025.classList.add('scatter-out');
        digits2026.classList.add('show','scatter-in');
      }, 2200);

      setTimeout(() => {
        digits2025.classList.remove('show','scatter-out');
        digits2026.classList.remove('scatter-in');
      }, 4200);
    }
  </script>
</body>
</html>

